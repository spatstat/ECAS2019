---
title: "Notes for session 2"
author: "Adrian Baddeley and Ege Rubak"
date: "2019-07-02"
output: html
---

# Intensity


## Intensity and probability density

Definition

Objectives

## Nonparametric estimation

### Nonparametric estimation of spatially-varying intensity

```{r, fig.width=5, out.width='70%'}
library(spatstat)
X <- japanesepines
A <- quadratcount(X, 3, 3)
Z <- density(X)
Z <- density(X, bw.diggle)
plot(Z, main="")
```

### Nonparametric estimation of spatially-varying, mark-dependent intensity

```{r}
M <- split(mucosa)
B <- density(M, bw.diggle)
plot(B, main="")
```

Ratio of intensities

```{r}
plot(relrisk(mucosa, casecontrol=FALSE))
```

### Nonparametric estimation of intensity depending on a covariate

```{r}
E <- split(mucosa)$ECL
g <- rhohat(E, "y")
plot(g)
```

```{r}
X <- murchison$gold
L <- murchison$faults
X <- rescale(X, 1000, "km")
L <- rescale(L, 1000, "km")
D <- distfun(L)
h <- rhohat(X, D)
plot(h)
```

## Parametric modelling

### Loglinear model for intensity

$$\log\lambda(u) = \beta_1 Z_1(u) + \ldots + \beta_p Z_p(u)$$

Explain about canonical variables vs original variables

### Fit using Poisson likelihood

```{r}
fit <- ppm(X ~ D)
coef(fit)
confint(fit)
anova(fit, test="Chi")
plot(effectfun(fit, "D"), xlim=c(0, 20))
plot(predict(fit))
```

```{r}
Jfit <- ppm(japanesepines ~ x + y)
Jfit
confint(Jfit)
Jfit2 <- ppm(japanesepines ~ polynom(x,y,2))
Jfit2
plot(predict(Jfit2))
```

```{r}
anova(Jfit, Jfit2, test="Chi")
```

```{r}
step(Jfit2)
```

```{r}
plot(simulate(Jfit2))
```

```{r}
plot(simulate(Jfit2, nsim=12))
```

### Intensity depends on marks

```{r}
model0 <- ppm(mucosa ~ marks)
model0
coef(model0)
plot(predict(model0))
```

```{r}
model1 <- ppm(mucosa ~ marks + y)
model1
coef(model1)
plot(predict(model1))
```

```{r}
model2 <- ppm(mucosa ~ marks * y)
model2
coef(model2)
plot(predict(model2))
```

```{r}
model1xy <- ppm(mucosa ~ marks + x + y)
model1xy
coef(model1xy)
plot(predict(model1xy))
```

```{r}
model2xy <- ppm(mucosa ~ marks * (x + y))
model2xy
coef(model2xy)
plot(predict(model2xy))
```

```{r}
model3 <- ppm(mucosa ~ marks + polynom(x, y, 2))
model3
coef(model3)
plot(predict(model3))
```

```{r}
model4 <- ppm(mucosa ~ marks * polynom(x,y,2))
model4
coef(model4)
plot(predict(model4))
```

_relrisk.ppm_

```{r}
plot(relrisk(model4, casecontrol=FALSE))
```

```{r}
plot(relrisk(model3, casecontrol=FALSE))
```
